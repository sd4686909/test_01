<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Sense - MBTI Deep Analysis</title>
    <style>
        /* ==================== 1. æ ¸å¿ƒè§†è§‰æ ·å¼ ==================== */
        :root {
            --font-stack: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
            --font-head: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-main: #1d1d1f;
            --text-secondary: #86868b;
            --border: #e5e5ea;
            --theme-color: #0071e3; /* è“è‰²ç³» (Aé€‰é¡¹) */
            --warm-color: #ff2d55;  /* çº¢è‰²ç³» (Bé€‰é¡¹) */
            --accent-color: #000000;
            --radius-card: 24px;
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: var(--font-stack); background-color: var(--bg-color); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* ==================== 2. å¸ƒå±€ä¸å¤´éƒ¨ ==================== */
        .header {
            padding: 15px 40px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border);
            position: fixed; top: 0; left: 0; right: 0; z-index: 20; height: 70px;
        }
        .logo { font-family: var(--font-head); font-size: 20px; font-weight: 800; letter-spacing: -0.5px; color: #000; }
        .progress-text { font-size: 14px; color: var(--text-secondary); font-weight: 600; display:none; }
        .close-btn { cursor: pointer; font-size: 24px; color: var(--text-secondary); transition: 0.2s; }
        .close-btn:hover { color: var(--text-main); }

        .container {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 90px 20px 40px 20px; max-width: 1100px; margin: 0 auto; width: 100%; overflow-y: auto;
        }

        /* ==================== 3. é¦–é¡µ ==================== */
        .intro-box { text-align: center; animation: fadeIn 0.8s ease; max-width: 700px; padding: 40px; }
        .intro-icon { font-size: 64px; margin-bottom: 20px; display: block; }
        .intro-title { font-size: 48px; font-weight: 800; margin-bottom: 24px; font-family: var(--font-head); color: #000; letter-spacing: -1px; }
        .intro-desc { font-size: 18px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 50px; font-weight: 400; }
        
        .btn-start {
            padding: 16px 48px; background: #000; color: #fff; border: none; border-radius: 40px;
            font-size: 17px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .btn-start:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(0,0,0,0.3); }
        .btn-start:active { transform: scale(0.98); }

        /* ==================== 4. ç­”é¢˜äº¤äº’ (ç²¾å‡†å¯¹é½ç‰ˆ) ==================== */
        .quiz-wrapper { width: 100%; max-width: 900px; display: none; animation: slideUp 0.5s ease; padding-bottom: 60px; }
        
        .progress-track { width: 100%; height: 6px; background: #e5e5ea; border-radius: 3px; margin-bottom: 40px; overflow: hidden; }
        .progress-fill { height: 100%; background: #000; width: 0%; transition: width 0.3s ease; border-radius: 3px; }

        .question-card {
            background: var(--card-bg); padding: 50px; border-radius: 32px; box-shadow: var(--shadow-lg);
            text-align: center; position: relative;
        }
        .q-text { font-size: 26px; font-weight: 700; margin-bottom: 50px; line-height: 1.4; color: #000; min-height: 70px; display: flex; align-items: center; justify-content: center; }

        /* é€‰é¡¹æè¿°åŒº */
        .options-display { display: flex; justify-content: space-between; margin-bottom: 40px; gap: 30px; align-items: stretch; }
        .opt-box {
            flex: 1; padding: 25px; border-radius: 20px; background: #f5f5f7;
            font-size: 16px; color: #555; transition: 0.3s; line-height: 1.5; font-weight: 500;
            display: flex; align-items: center; justify-content: center; text-align: center; border: 2px solid transparent;
        }
        .opt-box.active-a { background: #eef2ff; border-color: var(--theme-color); color: var(--theme-color); box-shadow: 0 4px 15px rgba(0,113,227,0.15); }
        .opt-box.active-b { background: #fff0f5; border-color: var(--warm-color); color: var(--warm-color); box-shadow: 0 4px 15px rgba(255,45,85,0.15); }

        /* åˆ»åº¦å°ºå®¹å™¨ */
        .scale-area { position: relative; margin: 0 20px; height: 80px; display: flex; align-items: flex-end; justify-content: center; }
        
        /* è½´çº¿èƒŒæ™¯ */
        .scale-line {
            position: absolute; top: 55px; left: 0; right: 0; height: 4px; background: #e5e5ea; border-radius: 2px; z-index: 1;
        }

        /* åˆ»åº¦ç‚¹å®¹å™¨ (Flex å¸ƒå±€ä¿è¯å¯¹é½) */
        .scale-points-wrapper {
            display: flex; justify-content: space-between; width: 100%; position: relative; z-index: 2;
        }

        /* å•ä¸ªåˆ»åº¦é¡¹ */
        .scale-item {
            display: flex; flex-direction: column; align-items: center; cursor: pointer; width: 80px;
            transition: transform 0.2s;
        }
        .scale-item:hover { transform: translateY(-2px); }

        /* æ–‡å­—æ ‡ç­¾ */
        .scale-label {
            font-size: 12px; font-weight: 600; margin-bottom: 12px; opacity: 0.5; transition: 0.2s;
            text-align: center; white-space: nowrap;
        }
        /* é¢œè‰²åŒºåˆ† */
        .scale-item.side-a .scale-label { color: var(--theme-color); }
        .scale-item.side-b .scale-label { color: var(--warm-color); }
        
        /* é€‰ä¸­æ€/Hoveræ€ æ–‡å­—å˜å® */
        .scale-item:hover .scale-label, .scale-item.active .scale-label { opacity: 1; transform: scale(1.05); }

        /* åœ†ç‚¹ */
        .scale-dot {
            width: 24px; height: 24px; border-radius: 50%; background: #fff;
            border: 2px solid #d1d1d6; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* é€‰ä¸­æ€åœ†ç‚¹ */
        .scale-item.side-a:hover .scale-dot { border-color: var(--theme-color); }
        .scale-item.side-b:hover .scale-dot { border-color: var(--warm-color); }

        .scale-item.active.side-a .scale-dot {
            background: var(--theme-color); border-color: var(--theme-color); transform: scale(1.3);
            box-shadow: 0 4px 10px rgba(0,113,227,0.4);
        }
        .scale-item.active.side-b .scale-dot {
            background: var(--warm-color); border-color: var(--warm-color); transform: scale(1.3);
            box-shadow: 0 4px 10px rgba(255,45,85,0.4);
        }
        
        /* åœ†ç‚¹å¤§å°å¾®è°ƒ (ä¸­é—´çš„å°ä¸€ç‚¹ï¼Œä¸¤è¾¹å¤§ä¸€ç‚¹ï¼Œå¯é€‰) */
        .scale-item:nth-child(3) .scale-dot, .scale-item:nth-child(4) .scale-dot { width: 20px; height: 20px; }
        .scale-item:nth-child(1) .scale-dot, .scale-item:nth-child(6) .scale-dot { width: 28px; height: 28px; }


        .action-row { margin-top: 50px; display: flex; justify-content: center; gap: 20px; }
        .nav-btn {
            width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer;
            background: #f0f0f2; color: #86868b; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .nav-btn:hover { background: #e5e5ea; color: #000; }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* ==================== 5. ç»“æœé¡µ (æ¥åœ°æ°”æ·±åº¦ç‰ˆ) ==================== */
        .result-container { display: none; width: 100%; animation: fadeIn 0.8s ease; padding-bottom: 80px; }
        
        .result-layout { display: flex; gap: 50px; align-items: flex-start; }
        @media (max-width: 900px) { .result-layout { flex-direction: column; } }

        /* å·¦ä¾§ï¼šæ•°æ®é¢æ¿ */
        .result-sidebar { flex: 0 0 340px; position: sticky; top: 100px; }
        .res-card-visual {
            background: #fff; border-radius: 24px; padding: 30px; box-shadow: var(--shadow-sm);
            text-align: center; border: 1px solid var(--border); margin-bottom: 20px;
        }
        
        .type-code { font-size: 80px; font-weight: 900; line-height: 1; margin-bottom: 5px; font-family: var(--font-head); letter-spacing: -2px; color: #000; }
        .type-name { font-size: 24px; font-weight: 700; color: #555; margin-bottom: 15px; }
        .type-tag { display: inline-block; padding: 6px 16px; background: #000; color: #fff; border-radius: 20px; font-size: 13px; font-weight: 600; margin-bottom: 30px; }

        .chart-radar-box { height: 260px; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }

        .dim-bars { margin-top: 20px; text-align: left; }
        .dim-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; font-size: 12px; font-weight: 700; color: #888; }
        .dim-track { flex: 1; height: 8px; background: #f0f0f2; border-radius: 4px; margin: 0 10px; position: relative; overflow: hidden; }
        .dim-fill-l { position: absolute; left: 0; top: 0; height: 100%; background: var(--theme-color); }
        .dim-fill-r { position: absolute; right: 0; top: 0; height: 100%; background: var(--warm-color); }
        
        /* å³ä¾§ï¼šæ·±åº¦å†…å®¹ */
        .result-content { flex: 1; background: #fff; border-radius: 24px; padding: 60px; box-shadow: var(--shadow-sm); border: 1px solid var(--border); }
        
        .article-title { font-size: 32px; font-weight: 800; margin-bottom: 10px; color: #1d1d1f; letter-spacing: -0.5px; }
        .article-subtitle { font-size: 18px; color: var(--text-secondary); margin-bottom: 50px; font-weight: 400; line-height: 1.6; border-bottom: 1px solid #f0f0f2; padding-bottom: 20px; }

        .section-block { margin-bottom: 50px; }
        .section-head { font-size: 22px; font-weight: 700; color: #000; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .section-icon { font-size: 24px; }
        
        .text-para { font-size: 17px; line-height: 1.9; color: #333; margin-bottom: 18px; text-align: justify; }
        .list-item { margin-bottom: 12px; padding-left: 20px; position: relative; font-size: 17px; color: #444; line-height: 1.7; }
        .list-item::before { content: "â€¢"; position: absolute; left: 0; color: var(--theme-color); font-weight: bold; }

        /* æ–°å¢å›¾è¡¨ç»„ä»¶ (æ–‡ç« å†…) */
        .mini-chart-box { background: #f9f9fa; border-radius: 16px; padding: 20px; margin: 20px 0; border: 1px solid #eee; }
        .chart-label { font-size: 13px; font-weight: 600; color: #888; margin-bottom: 8px; text-align: center; }
        
        /* ç”µæ± å›¾ (èƒ½é‡æ¥æº) */
        .battery-container { display: flex; height: 30px; border-radius: 6px; overflow: hidden; border: 2px solid #333; width: 80%; margin: 0 auto; position: relative; }
        .battery-pos { height: 100%; background: var(--theme-color); transition: width 1s; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 12px; font-weight: bold; }
        .battery-tip { width: 6px; height: 14px; background: #333; position: absolute; right: -8px; top: 6px; border-radius: 0 2px 2px 0; }

        /* å¤©å¹³å›¾ (å†³ç­–) */
        .balance-scale { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; }
        .balance-side { text-align: center; font-size: 14px; font-weight: 600; width: 40%; }
        .balance-bar { flex: 1; height: 6px; background: #e5e5ea; border-radius: 3px; position: relative; }
        .balance-knob { width: 16px; height: 16px; background: #000; border-radius: 50%; position: absolute; top: -5px; transition: left 1s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="logo">Daily Sense. <span style="font-weight:400; color:#86868b; margin-left:10px;">MBTI Deep Dive</span></div>
        <div class="progress-text" id="progressText"></div>
        <div class="close-btn" onclick="window.close()">âœ•</div>
    </header>

    <div class="container">
        
        <!-- 1. é¦–é¡µ (ç»å…¸é»‘ç™½) -->
        <div id="introPage" class="intro-box">
            <div class="intro-icon">ğŸ§¬</div>
            <h1 class="intro-title">æ¢ç´¢ä½ çš„äººæ ¼å®‡å®™</h1>
            <p class="intro-desc">
                è¿™æ˜¯ä¸€æ¬¡åŸºäºè£æ ¼å¿ƒç†å­¦ç»´åº¦çš„æ·±åº¦è‡ªæˆ‘æ‰«æã€‚<br>
                æµ‹è¯•å…± 48 é“æƒ…å¢ƒé¢˜ï¼Œé‡‡ç”¨ç²¾å‡†çš„æƒé‡åˆ†é…æœºåˆ¶ï¼Œ<br>
                æ•æ‰ä½ æ½œæ„è¯†ä¸­æœ€çœŸå®çš„æ€§æ ¼åº•è‰²ã€‚
            </p>
            <button class="btn-start" onclick="startQuiz()">å¼€å§‹æ·±åº¦æ¢ç´¢</button>
        </div>

        <!-- 2. ç­”é¢˜é¡µ (ç²¾ç¡®å¯¹é½ç‰ˆ) -->
        <div id="quizPage" class="quiz-wrapper">
            <div class="progress-track"><div class="progress-fill" id="progressBar"></div></div>
            
            <div class="question-card">
                <div class="q-text" id="qText">é¢˜ç›®åŠ è½½ä¸­...</div>
                
                <div class="options-display">
                    <div class="opt-box" id="optADesc">é€‰é¡¹ A</div>
                    <div class="opt-box" id="optBDesc">é€‰é¡¹ B</div>
                </div>

                <!-- ä¼˜åŒ–åçš„åˆ»åº¦å°ºï¼šæ–‡å­—ä¸åœ†ç‚¹å‚ç›´å¯¹é½ -->
                <div class="scale-area">
                    <div class="scale-line"></div>
                    <div class="scale-points-wrapper">
                        <!-- Aç«¯: 5:0 (Index 0) -->
                        <div class="scale-item side-a" onclick="setScore(0)" id="item0">
                            <span class="scale-label">ä¸¥é‡åŒæ„</span>
                            <div class="scale-dot"></div>
                        </div>
                        <!-- Aç«¯: 4:1 (Index 1) -->
                        <div class="scale-item side-a" onclick="setScore(1)" id="item1">
                            <span class="scale-label">ä¸€èˆ¬åŒæ„</span>
                            <div class="scale-dot"></div>
                        </div>
                        <!-- Aç«¯: 3:2 (Index 2) -->
                        <div class="scale-item side-a" onclick="setScore(2)" id="item2">
                            <span class="scale-label">æœ‰ç‚¹åŒæ„</span>
                            <div class="scale-dot"></div>
                        </div>
                        
                        <!-- Bç«¯: 2:3 (Index 3) -->
                        <div class="scale-item side-b" onclick="setScore(3)" id="item3">
                            <span class="scale-label">æœ‰ç‚¹åŒæ„</span>
                            <div class="scale-dot"></div>
                        </div>
                        <!-- Bç«¯: 1:4 (Index 4) -->
                        <div class="scale-item side-b" onclick="setScore(4)" id="item4">
                            <span class="scale-label">ä¸€èˆ¬åŒæ„</span>
                            <div class="scale-dot"></div>
                        </div>
                        <!-- Bç«¯: 0:5 (Index 5) -->
                        <div class="scale-item side-b" onclick="setScore(5)" id="item5">
                            <span class="scale-label">ä¸¥é‡åŒæ„</span>
                            <div class="scale-dot"></div>
                        </div>
                    </div>
                </div>

                <div class="action-row">
                    <button class="nav-btn" id="prevBtn" onclick="prevQuestion()">â†</button>
                </div>
            </div>
        </div>

        <!-- 3. ç»“æœé¡µ (æ·±åº¦æ–‡ç«  + å›¾è¡¨) -->
        <div id="resultPage" class="result-container">
            <div class="result-layout">
                
                <!-- å·¦ä¾§ï¼šè§†è§‰æ¦‚è§ˆ -->
                <aside class="result-sidebar">
                    <div class="res-card-visual">
                        <div class="type-code" id="resCode">--</div>
                        <div class="type-name" id="resName">--</div>
                        <div class="type-tag" id="resSlogan">--</div>
                        
                        <div class="chart-radar-box">
                            <canvas id="radarCanvas" width="260" height="260"></canvas>
                        </div>

                        <!-- ç»´åº¦å¹³è¡¡æ¡ -->
                        <div class="dim-bars">
                            <div class="dim-row">
                                <span style="color:var(--theme-color)">E å¤–å‘</span>
                                <div class="dim-track"><div class="dim-fill-l" id="barE" style="width:0%"></div></div>
                                <div class="dim-track"><div class="dim-fill-r" id="barI" style="width:0%"></div></div>
                                <span style="color:var(--warm-color)">I å†…å‘</span>
                            </div>
                            <div class="dim-row">
                                <span style="color:var(--theme-color)">S å®æ„Ÿ</span>
                                <div class="dim-track"><div class="dim-fill-l" id="barS" style="width:0%"></div></div>
                                <div class="dim-track"><div class="dim-fill-r" id="barN" style="width:0%"></div></div>
                                <span style="color:var(--warm-color)">N ç›´è§‰</span>
                            </div>
                            <div class="dim-row">
                                <span style="color:var(--theme-color)">T ç†æ™º</span>
                                <div class="dim-track"><div class="dim-fill-l" id="barT" style="width:0%"></div></div>
                                <div class="dim-track"><div class="dim-fill-r" id="barF" style="width:0%"></div></div>
                                <span style="color:var(--warm-color)">F æƒ…æ„Ÿ</span>
                            </div>
                            <div class="dim-row">
                                <span style="color:var(--theme-color)">J åˆ¤æ–­</span>
                                <div class="dim-track"><div class="dim-fill-l" id="barJ" style="width:0%"></div></div>
                                <div class="dim-track"><div class="dim-fill-r" id="barP" style="width:0%"></div></div>
                                <span style="color:var(--warm-color)">P æ„ŸçŸ¥</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align:center;">
                        <button class="btn-start" style="padding:12px 30px; font-size:14px; background:#f0f0f2; color:#333; box-shadow:none;" onclick="location.reload()">é‡æ–°æµ‹è¯•</button>
                    </div>
                </aside>

                <!-- å³ä¾§ï¼šæ·±åº¦è§£ææ–‡ç«  -->
                <article class="result-content">
                    <h2 class="article-title" id="artTitle">åˆ†ææŠ¥å‘Šç”Ÿæˆä¸­...</h2>
                    <p class="article-subtitle" id="artSubtitle">
                        è¿™ä»½æŠ¥å‘Šåƒæ˜¯ä¸€é¢é•œå­ã€‚åœ¨è¿™é‡Œï¼Œä½ ä¼šçœ‹åˆ°è‡ªå·±é‚£äº›ä¸æ›¾è¢«ç•™æ„çš„å¤©èµ‹ï¼Œä¹Ÿä¼šçœ‹æ¸…é‚£äº›ç»Šå€’ä½ çš„çŸ³å¤´ã€‚
                    </p>

                    <!-- 1. äººæ ¼åº•è‰² -->
                    <div class="section-block">
                        <div class="section-head"><span class="section-icon">ğŸ§ </span> ä½ çš„äººæ ¼åº•è‰² (The Core)</div>
                        <div id="textCore"></div>
                        
                        <!-- å›¾è¡¨ï¼šèƒ½é‡ç”µæ±  -->
                        <div class="mini-chart-box">
                            <div class="chart-label">ä½ çš„ç¤¾äº¤èƒ½é‡æ¥æº</div>
                            <div style="position:relative; width:80%; margin:0 auto;">
                                <div class="battery-container">
                                    <div class="battery-pos" id="batteryFill" style="width:50%">å†…éƒ¨</div>
                                    <div class="battery-tip"></div>
                                </div>
                                <div style="display:flex; justify-content:space-between; font-size:12px; color:#888; margin-top:5px;">
                                    <span>ç‹¬å¤„å……ç”µ (Introvert)</span>
                                    <span>ç¤¾äº¤å……ç”µ (Extrovert)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. ä¼˜åŠ¿ä¸ç›²ç‚¹ -->
                    <div class="section-block">
                        <div class="section-head"><span class="section-icon">âš¡</span> ä½ çš„å…‰èŠ’ä¸é˜´å½± (Strengths & Blindspots)</div>
                        <div id="textSW"></div>
                    </div>

                    <!-- 3. èŒåœº -->
                    <div class="section-block">
                        <div class="section-head"><span class="section-icon">ğŸ’¼</span> èŒåœºç”Ÿå­˜æ³•åˆ™ (Workplace)</div>
                        <div id="textWork"></div>
                        
                        <!-- å›¾è¡¨ï¼šå†³ç­–å¤©å¹³ -->
                        <div class="mini-chart-box">
                            <div class="chart-label">ä½ çš„å†³ç­–åå¥½å¤©å¹³</div>
                            <div class="balance-scale">
                                <div class="balance-side" style="color:var(--theme-color)">ç†æ€§é€»è¾‘</div>
                                <div class="balance-bar"><div class="balance-knob" id="balanceKnob" style="left:50%"></div></div>
                                <div class="balance-side" style="color:var(--warm-color)">æƒ…æ„Ÿä»·å€¼</div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. æƒ…æ„Ÿ -->
                    <div class="section-block">
                        <div class="section-head"><span class="section-icon">â¤ï¸</span> äº²å¯†å…³ç³»çœŸç›¸ (Relationships)</div>
                        <div id="textLove"></div>
                    </div>

                    <!-- 5. å»ºè®® -->
                    <div class="section-block">
                        <div class="section-head"><span class="section-icon">ğŸš€</span> è‡ªæˆ‘è¿›åŒ–æŒ‡å— (Evolution)</div>
                        <div id="textAdvice"></div>
                    </div>
                </article>

            </div>
        </div>
    </div>

    <script>
        // ==================== 1. å®Œæ•´48é¢˜åº“ (Standard 48-item MBTI) ====================
        const fullQuestions = [
            { id:1,  text: "å½“ä½ è¦å»è®¤è¯†æ–°æœ‹å‹æ—¶ï¼Œä½ ä¼šï¼š", A: "æ—¢æƒ³è¦å¤šè·Ÿå¯¹æ–¹è¯´è¯ï¼Œä¹Ÿæƒ³è¦å¬å¯¹æ–¹è¯´è¯", B: "æ›´æƒ³è¦å¬å¯¹æ–¹è¯´è¯", col:1 },
            { id:2,  text: "ä¸‹åˆ—å“ªä¸€ç§æ˜¯æ‚¨çš„ç”Ÿæ´»å–å‘ï¼Ÿ", A: "åªç®¡åšå§", B: "æ‰¾å‡ºå¤šç§ä¸åŒé€‰æ‹©", col:2 },
            { id:3,  text: "å–œæ¬¢è‡ªå·±çš„å“ªç§æ€§æ ¼ï¼Ÿ", A: "å†·é™è€Œç†æ€§", B: "çƒ­æƒ…è€Œä½“è°…", col:3 },
            { id:4,  text: "ä½ æ“…é•¿ï¼š", A: "åœ¨æœ‰éœ€è¦æ—¶å¯ä»¥åŒæ—¶åè°ƒè¿›è¡Œå¤šé¡¹å·¥ä½œ", B: "ä¸“æ³¨åœ¨æŸä¸€é¡¹å·¥ä½œä¸Šï¼Œç›´åˆ°æŠŠå®ƒå®Œæˆ", col:4 },
            { id:5,  text: "ä½ å‚ä¸ç¤¾äº¤èšä¼šæ—¶ï¼š", A: "æ€»æ˜¯èƒ½è®¤è¯†æ–°æœ‹å‹", B: "åªè·Ÿå‡ ä¸ªäº²å¯†æŒšå‹å‘†åœ¨ä¸€èµ·", col:1 },
            { id:6,  text: "å½“ä½ å°è¯•äº†è§£æŸäº›äº‹æƒ…æ—¶ï¼Œä¸€èˆ¬ä½ ä¼šï¼š", A: "å…ˆäº†è§£ç»†èŠ‚", B: "å…ˆäº†è§£æ•´ä½“æƒ…å†µï¼Œç»†èŠ‚è£åå†è°ˆ", col:2 },
            { id:7,  text: "ä½ æ›´æƒ³ï¼Ÿ", A: "çŸ¥é“åˆ«äººçš„æƒ³æ³•", B: "çŸ¥é“åˆ«äººçš„æ„Ÿå—", col:3 },
            { id:8,  text: "ä½ å–œæ¬¢ä¸‹åˆ—å“ªä¸ªå·¥ä½œï¼Ÿ", A: "èƒ½è®©ä½ è¿…é€Ÿå’Œå³æ—¶åšå‡ºååº”çš„å·¥ä½œ", B: "èƒ½è®©ä½ å®šå‡ºç›®æ ‡ï¼Œç„¶åé€æ­¥è¾¾æˆç›®æ ‡çš„å·¥ä½œ", col:4 },
            { id:9,  text: "å½“ä½ ä¸æœ‹å‹èšä¼šè¿‡åï¼Ÿ", A: "æˆ‘ä¼šæ„Ÿåˆ°ç²¾åŠ›å……æ²›", B: "æˆ‘ä¼šæ„Ÿåˆ°ç–²ç´¯", col:1 },
            { id:10, text: "æˆ‘æ¯”è¾ƒæœ‰å…´è¶£çŸ¥é“ä¸‹åˆ—å“ªä¸€ä¸ªï¼Ÿ", A: "åˆ«äººçš„ç»å†ï¼Œä¾‹å¦‚ä»–ä»¬åšè¿‡ä»€ä¹ˆ", B: "åˆ«äººçš„æ¢¦æƒ³ï¼Œä¾‹å¦‚ä»–ä»¬æƒ³å¹²å˜›ï¼Œä¼šå»å“ªé‡Œ", col:2 },
            { id:11, text: "æˆ‘æ¯”è¾ƒæ“…é•¿ï¼Ÿ", A: "è®¢å‡ºä¸€äº›å¯è¡Œçš„è®¡åˆ’", B: "è¯´æœåˆ«äººåŒæ„ä½ çš„è®¡åˆ’ï¼Œå¹¶æ„¿æ„ä¸ä½ åˆä½œ", col:3 },
            { id:12, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "æˆ‘ä¼šçªç„¶å°è¯•åšæŸäº›äº‹ï¼Œçœ‹çœ‹ä¼šæœ‰ä»€ä¹ˆäº‹æƒ…å‘ç”Ÿ", B: "æˆ‘å°è¯•åšä»»åŠ¡å‰ï¼Œéƒ½æƒ³é¢„å…ˆçŸ¥é“å¯èƒ½æœ‰ä»€ä¹ˆäº‹æƒ…ä¼šå‘ç”Ÿ", col:4 },
            { id:13, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "æˆ‘ç»å¸¸è¾¹è¯´è¯ï¼Œè¾¹æ€è€ƒ", B: "æˆ‘åœ¨è¯´è¯å‰ï¼Œé€šå¸¸ä¼šæ€è€ƒè¦è¯´çš„è¯", col:1 },
            { id:14, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å‘¨å›´çš„ç¯å¢ƒå¯¹æˆ‘å¾ˆé‡è¦", B: "å¦‚æœæ˜¯åšæˆ‘å–œæ¬¢åšçš„äº‹æƒ…ï¼Œç¯å¢ƒå¯¹æˆ‘è€Œè¨€å¹¶æ²¡æœ‰é‚£ä¹ˆé‡è¦", col:2 },
            { id:15, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "æˆ‘å–œæ¬¢åˆ†æï¼Œå¿ƒæ€ç¼œå¯†", B: "æˆ‘å¯¹äººæ„Ÿå…´è¶£ï¼Œå…³å¿ƒä»–ä»¬æ‰€å‘ç”Ÿçš„äº‹", col:3 },
            { id:16, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å³ä½¿å·²ç»æœ‰äº†è®¡åˆ’ï¼Œæˆ‘ä¹Ÿå–œæ¬¢æ¢è®¨å…¶ä»–æ–°çš„æ–¹æ¡ˆ", B: "ä¸€æ—¦å®šå‡ºè®¡åˆ’ï¼Œæˆ‘ä¾¿å¸Œæœ›èƒ½ä¾è®¡è¡Œäº‹", col:4 },
            { id:17, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "ä¸€èˆ¬äººéƒ½çŸ¥é“ä»€ä¹ˆå¯¹æˆ‘æ¥è¯´æ˜¯é‡è¦çš„", B: "é™¤äº†äº²è¿‘çš„äººï¼Œæˆ‘ä¸ä¼šè¯´å‡ºä»€ä¹ˆå¯¹æˆ‘æ¥è¯´æ˜¯é‡è¦çš„", col:1 },
            { id:18, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å¦‚æœæˆ‘å–œæ¬¢æŸç§æ´»åŠ¨ï¼Œæˆ‘ä¼šç»å¸¸è¿›è¡Œè¿™ç§æ´»åŠ¨", B: "æˆ‘åªè¦ç†Ÿæ‚‰æŸç§æ´»åŠ¨åï¼Œä¾¿å¸Œæœ›è½¬è€Œå°è¯•å…¶ä»–æ–°çš„æ´»åŠ¨", col:2 },
            { id:19, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "åšå†³å®šæ—¶ï¼Œæˆ‘æ›´å¤šä¼šè€ƒè™‘æ­£åä¸¤é¢çš„è§‚ç‚¹", B: "åšå†³å®šæ—¶ï¼Œæˆ‘ä¼šæ›´å¤šå»äº†è§£å…¶ä»–äººçš„æƒ³æ³•", col:3 },
            { id:20, text: "å½“ä½ ä¸“æ³¨åšæŸä»¶äº‹æƒ…æ—¶ï¼Ÿ", A: "ä½ éœ€è¦æ—¶ä¸æ—¶çš„åœä¸‹æ¥ä¼‘æ¯ä¼šå„¿å†åš", B: "ä½ ä¸å¸Œæœ›å—åˆ°ä»»ä½•å¹²æ‰°", col:4 },
            { id:21, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "æˆ‘ç‹¬å¤„å¤ªä¹…ï¼Œä¾¿ä¼šæ„Ÿåˆ°ä¸å®‰", B: "è‹¥æ²¡æœ‰è¶³å¤Ÿçš„è‡ªå¤„æ—¶é—´ï¼Œæˆ‘ä¾¿ä¼šæ„Ÿåˆ°çƒ¦èºä¸å®‰", col:1 },
            { id:22, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "æˆ‘å¯¹ä¸€äº›æ²¡æœ‰å®é™…ç”¨é€”çš„æ„å¿µä¸æ„Ÿå…´è¶£", B: "æˆ‘å–œæ¬¢æ„å¿µæœ¬èº«ï¼Œå¹¶äº«å—æƒ³è±¡æ„å¿µçš„è¿‡ç¨‹", col:2 },
            { id:23, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å½“è¿›è¡Œè°ˆåˆ¤æ—¶ï¼Œæˆ‘ä¾é è‡ªå·±çš„çŸ¥è¯†å’ŒæŠ€å·§", B: "å½“è¿›è¡Œè°ˆåˆ¤æ—¶ï¼Œæˆ‘ä¼šæ‹‰æ‹¢å…¶ä»–äººè‡³åŒä¸€é˜µçº¿", col:3 },
            { id:24, text: "å½“ä½ æ”¾å‡æ—¶ï¼Œä½ å¤šæ•°ä¼šï¼Ÿ", A: "éšé‡è€Œå®‰ï¼Œåšå½“æ—¶æƒ³åšçš„äº‹", B: "ä¸ºæƒ³åšçš„äº‹æƒ…è®¢å‡ºæ—¶é—´è¡¨", col:4 },
            { id:25, text: "å½“ä½ æ”¾å‡æ—¶ï¼Œä½ å¤šæ•°ä¼šï¼Ÿ", A: "èŠ±å¤šäº›æ—¶é—´ä¸åˆ«äººå…±åº¦", B: "èŠ±å¤šäº›æ—¶é—´è‡ªå·±é˜…è¯»ã€æ•£æ­¥æˆ–è€…å‘ç™½æ—¥æ¢¦", col:1 },
            { id:26, text: "å½“ä½ æ”¾å‡æ—¶ï¼Œä½ å¤šæ•°ä¼šï¼Ÿ", A: "å»ä½ æ›¾ç»å¾ˆå–œæ¬¢çš„åœ°æ–¹å»åº¦å‡", B: "é€‰æ‹©å»ä¸€äº›ä½ ä¹‹å‰æ²¡æœ‰å»è¿‡çš„åœ°æ–¹", col:2 },
            { id:27, text: "å½“ä½ æ”¾å‡æ—¶ï¼Œä½ å¤šæ•°ä¼šï¼Ÿ", A: "å¸¦ç€ä¸€äº›ä¸å·¥ä½œæˆ–å­¦æ ¡æœ‰å…³çš„äº‹æƒ…", B: "å¤„ç†ä¸€äº›å¯¹ä½ é‡è¦çš„äººé™…å…³ç³»", col:3 },
            { id:28, text: "å½“ä½ æ”¾å‡æ—¶ï¼Œä½ å¤šæ•°ä¼šï¼Ÿ", A: "å¿˜è®°å¹³æ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼Œä¸“å¿ƒäº«ä¹", B: "æƒ³ç€å‡æœŸè¿‡åè¦å‡†å¤‡çš„äº‹æƒ…", col:4 },
            { id:29, text: "å½“ä½ å‡ºå»æ—…æ¸¸çš„æ—¶å€™ï¼Œä½ æ›´å€¾å‘äºï¼š", A: "å‚è§‚è‘—åæ™¯ç‚¹", B: "èŠ±æ—¶é—´é€›åšç‰©é¦†å’Œä¸€äº›è¾ƒä¸ºå¹½é™çš„åœ°æ–¹", col:1 },
            { id:30, text: "å½“ä½ å»é¤å…åƒé¥­çš„æ—¶å€™ï¼Ÿ", A: "ç‚¹é‚£äº›åƒè¿‡è§‰å¾—è¿˜ä¸é”™çš„èœå¼", B: "ä¼šå»å°è¯•æ–°çš„èœå¼", col:2 },
            { id:31, text: "ä¸‹åˆ—å“ªä¸ªè¯´æ³•èƒ½è´´åˆ‡å½¢å®¹ä½ å¯¹è‡ªå·±çš„çœ‹æ³•ï¼Ÿ", A: "åˆ«äººè®¤ä¸ºæˆ‘ä¼šå…¬æ­£å¤„äº‹", B: "åˆ«äººç›¸ä¿¡åœ¨ä»–ä»¬æœ‰éœ€è¦æ—¶ï¼Œæˆ‘ä¼šä¸€ç›´åœ¨ä»–ä»¬èº«è¾¹", col:3 },
            { id:32, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "éšæœºåº”å˜", B: "æŒ‰ç…§è®¡åˆ’è¡Œäº‹", col:4 },
            { id:33, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å¦ç‡", B: "æ·±æ²‰", col:1 },
            { id:34, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "ç•™æ„äº‹å®", B: "æ³¨é‡äº‹å®", col:2 },
            { id:35, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "çŸ¥è¯†å¹¿åš", B: "å–„è§£äººæ„", col:3 },
            { id:36, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å®¹æ˜“é€‚åº”å’Œè½¬å˜", B: "å¤„äº‹äº•äº•æœ‰æ¡", col:4 },
            { id:37, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "çˆ½æœ—", B: "æ²‰ç¨³", col:1 },
            { id:38, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å®äº‹æ±‚æ˜¯", B: "å¯Œæƒ³è±¡åŠ›", col:2 },
            { id:39, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å–œæ¬¢è¯¢é—®å®æƒ…", B: "å–œæ¬¢æ¢ç´¢æ„Ÿå—", col:3 },
            { id:40, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "ä¸æ–­æ¥å—æ–°æ„è§", B: "ç€çœ¼è¾¾æˆç›®æ ‡", col:4 },
            { id:41, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "ç‡çœŸ", B: "å†…æ•›", col:1 },
            { id:42, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å®äº‹æ±‚æ˜¯", B: "å…·è¿œå¤§ç›®å…‰", col:2 },
            { id:43, text: "ä¸‹åˆ—å“ªç§è¯´æ³•è¾ƒé€‚åˆä½ ï¼Ÿ", A: "å…¬æ­£", B: "å®½å®¹", col:3 },
            { id:44, text: "å½“ä½ é‡åˆ°ä¸€äº›ä¸æ„‰å¿«çš„äº‹æƒ…æ—¶ï¼š", A: "æš‚æ—¶æ”¾ä¸‹ä¸æ„‰å¿«çš„äº‹æƒ…", B: "åŠæ—¶å¤„ç†ä¸æ„‰å¿«çš„äº‹æƒ…", col:4 },
            { id:45, text: "ä½ å€¾å‘ï¼š", A: "è‡ªå·±çš„å·¥ä½œè¢«æ¬£èµ", B: "åˆ›é€ ä¸€äº›æœ‰é•¿è¿œä»·å€¼çš„ä¸œè¥¿", col:1 },
            { id:46, text: "ä½ å€¾å‘ï¼š", A: "åœ¨è‡ªå·±æœ‰å…´è¶£çš„èŒƒç•´ï¼Œç§¯ç´¯ä¸°å¯Œçš„ç»éªŒ", B: "æœ‰å„å¼å„æ ·ä¸åŒçš„ç»éªŒ", col:2 },
            { id:47, text: "å“ªä¸€å¥èƒ½è¡¨è¾¾ä½ çš„çœ‹æ³•ï¼Ÿ", A: "æ„Ÿæƒ…ç”¨äº‹çš„äººæ¯”è¾ƒå®¹æ˜“çŠ¯é”™", B: "é€»è¾‘æ€ç»´ä¼šä»¤äººè‡ªä»¥ä¸ºæ˜¯", col:3 },
            { id:48, text: "å“ªä¸€å¥èƒ½è¡¨è¾¾ä½ çš„çœ‹æ³•ï¼Ÿ", A: "çŠ¹è±«ä¸å†³å¿…å¤±è´¥", B: "ä¸‰æ€è€Œåè¡Œ", col:4 }
        ];

        // ==================== 2. æ·±åº¦æ–‡æ¡ˆåº“ (Expanded) ====================
        const typeDetails = {
            "INTJ": { name: "å»ºç­‘å¸ˆ", slogan: "æˆ˜ç•¥å¤§å¸ˆ", careers: "ç³»ç»Ÿæ¶æ„å¸ˆã€ç§‘å­¦å®¶ã€æŠ•èµ„é¡¾é—®ã€æˆ˜ç•¥è§„åˆ’å¸ˆ" },
            "INTP": { name: "é€»è¾‘å­¦å®¶", slogan: "åˆ›é€ åŠ›å¤©æ‰", careers: "ç¨‹åºå‘˜ã€å“²å­¦å®¶ã€æ•°å­¦å®¶ã€æ•°æ®åˆ†æå¸ˆ" },
            "ENTJ": { name: "æŒ‡æŒ¥å®˜", slogan: "å¤©ç”Ÿé¢†è¢–", careers: "CEOã€åˆ›ä¸šè€…ã€ç®¡ç†é¡¾é—®ã€æ³•å®˜" },
            "ENTP": { name: "è¾©è®ºå®¶", slogan: "æ€æƒ³å¼€æ‹“è€…", careers: "åˆ›æ„æ€»ç›‘ã€å¾‹å¸ˆã€äº§å“ç»ç†ã€é£é™©æŠ•èµ„äºº" },
            "INFJ": { name: "æå€¡è€…", slogan: "ç¥ç§˜çš„ç†æƒ³ä¸»ä¹‰è€…", careers: "å¿ƒç†å’¨è¯¢å¸ˆã€ä½œå®¶ã€HRDã€éè¥åˆ©ç»„ç»‡é¢†å¯¼" },
            "INFP": { name: "è°ƒåœè€…", slogan: "æ²»æ„ˆç³»è¯—äºº", careers: "è‰ºæœ¯å®¶ã€ç¼–è¾‘ã€è®¾è®¡å¸ˆã€å¿ƒç†æ²»ç–—å¸ˆ" },
            "ENFJ": { name: "ä¸»äººå…¬", slogan: "é­…åŠ›æ¼”è¯´å®¶", careers: "æ•™å¸ˆã€å…¬å…³ç»ç†ã€æ”¿æ²»å®¶ã€åŸ¹è®­å¸ˆ" },
            "ENFP": { name: "ç«é€‰è€…", slogan: "è‡ªç”±çš„çµé­‚", careers: "è®°è€…ã€æ´»åŠ¨ç­–åˆ’ã€ä¸»æŒäººã€æ—…æ¸¸åšä¸»" },
            "ISTJ": { name: "ç‰©æµå¸ˆ", slogan: "åšè‹¥ç£çŸ³", careers: "ä¼šè®¡ã€æ³•å®˜ã€å®¡è®¡å¸ˆã€é«˜çº§è¡Œæ”¿" },
            "ISFJ": { name: "å®ˆå«è€…", slogan: "æ¸©æš–çš„å®ˆæŠ¤è€…", careers: "åŒ»æŠ¤äººå‘˜ã€è¡Œæ”¿ä¸»ç®¡ã€ç¤¾å·¥ã€å¹¼æ•™" },
            "ESTJ": { name: "æ€»ç»ç†", slogan: "é«˜æ•ˆç®¡ç†è€…", careers: "é¡¹ç›®ç»ç†ã€é“¶è¡Œå®¶ã€å†›å®˜ã€å‚é•¿" },
            "ESFJ": { name: "æ‰§æ”¿å®˜", slogan: "ç¤¾äº¤è¾¾äºº", careers: "é”€å”®æ€»ç›‘ã€å®¢æˆ·æœåŠ¡ã€æ•™è‚²è¡Œæ”¿ã€å…¬å…³" },
            "ISTP": { name: "é‰´èµå®¶", slogan: "å†·é™çš„å·¥åŒ ", careers: "å·¥ç¨‹å¸ˆã€é£è¡Œå‘˜ã€èµ›è½¦æ‰‹ã€æ€¥è¯ŠåŒ»ç”Ÿ" },
            "ISFP": { name: "æ¢é™©å®¶", slogan: "çµåŠ¨è‰ºæœ¯å®¶", careers: "æ‘„å½±å¸ˆã€æ—¶å°šè®¾è®¡ã€å›­è‰ºå¸ˆã€å¨å¸ˆ" },
            "ESTP": { name: "ä¼ä¸šå®¶", slogan: "è¡ŒåŠ¨æ´¾", careers: "è‚¡ç¥¨ç»çºªã€æ¶ˆé˜²å‘˜ã€è°ˆåˆ¤ä¸“å®¶ã€æ‰¿åŒ…å•†" },
            "ESFP": { name: "è¡¨æ¼”è€…", slogan: "èšå…‰ç¯å® å„¿", careers: "æ¼”å‘˜ã€æ—…æ¸¸é¡¾é—®ã€æ´»åŠ¨ä¸»æŒã€æ—¶å°šä¹°æ‰‹" }
        };

        // ==================== 3. é€»è¾‘æ§åˆ¶ ====================
        let currentQIndex = 0;
        let answers = new Array(fullQuestions.length).fill(null);

        function startQuiz() {
            document.getElementById('introPage').style.display = 'none';
            document.getElementById('quizPage').style.display = 'block';
            document.getElementById('progressText').style.display = 'block';
            loadQuestion();
        }

        function loadQuestion() {
            const q = fullQuestions[currentQIndex];
            document.getElementById('progressText').innerText = `${currentQIndex + 1} / ${fullQuestions.length}`;
            document.getElementById('qText').innerText = q.text;
            document.getElementById('optADesc').innerText = q.A;
            document.getElementById('optBDesc').innerText = q.B;
            
            // è¿›åº¦æ¡
            const pct = ((currentQIndex) / fullQuestions.length) * 100;
            document.getElementById('progressBar').style.width = pct + "%";

            // æ¢å¤çŠ¶æ€
            resetSelector();
            const savedAns = answers[currentQIndex];
            if (savedAns) {
                updateScoreVisuals(savedAns.scoreB);
            }
            
            document.getElementById('prevBtn').disabled = (currentQIndex === 0);
        }

        function setScore(idx) {
            updateScoreVisuals(idx);
            
            const scoreB = idx;
            const scoreA = 5 - idx;
            const q = fullQuestions[currentQIndex];

            answers[currentQIndex] = {
                id: q.id, col: q.col, scoreA: scoreA, scoreB: scoreB
            };

            // è‡ªåŠ¨è·³è½¬
            setTimeout(() => {
                if(currentQIndex < fullQuestions.length - 1) {
                    currentQIndex++;
                    loadQuestion();
                } else {
                    finishQuiz();
                }
            }, 300);
        }

        function updateScoreVisuals(idx) {
            // æ¸…é™¤æ‰€æœ‰é€‰ä¸­
            document.querySelectorAll('.scale-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.opt-box').forEach(el => {
                el.classList.remove('active-a');
                el.classList.remove('active-b');
            });

            // æ¿€æ´»å½“å‰ç‚¹
            const item = document.getElementById('item'+idx);
            item.classList.add('active');
            
            // æ¿€æ´»å¯¹åº”é€‰é¡¹æ¡†
            if(idx <= 2) document.getElementById('optADesc').classList.add('active-a');
            else document.getElementById('optBDesc').classList.add('active-b');
        }

        function resetSelector() {
            document.querySelectorAll('.scale-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.opt-box').forEach(el => {
                el.classList.remove('active-a');
                el.classList.remove('active-b');
            });
        }

        function prevQuestion() {
            if(currentQIndex > 0) {
                currentQIndex--;
                loadQuestion();
            }
        }

        function finishQuiz() {
            document.getElementById('quizPage').style.display = 'none';
            document.getElementById('resultPage').style.display = 'block';
            document.getElementById('progressText').style.display = 'none';
            calculateAndRender();
        }

        // ==================== 4. ç»“æœè®¡ç®—ä¸å†…å®¹ç”Ÿæˆ ====================
        function calculateAndRender() {
            let sums = {
                col1: { A:0, B:0 }, // E / I
                col2: { A:0, B:0 }, // S / N
                col3: { A:0, B:0 }, // T / F
                col4: { A:0, B:0 }  // J / P
            };

            answers.forEach(ans => {
                if(ans.col === 1) { sums.col1.A += ans.scoreA; sums.col1.B += ans.scoreB; }
                if(ans.col === 2) { sums.col2.A += ans.scoreA; sums.col2.B += ans.scoreB; }
                if(ans.col === 3) { sums.col3.A += ans.scoreA; sums.col3.B += ans.scoreB; }
                if(ans.col === 4) { sums.col4.A += ans.scoreA; sums.col4.B += ans.scoreB; }
            });

            // åˆ¤å®šç»“æœ
            const L1 = sums.col1.A >= sums.col1.B ? 'E' : 'I';
            const L2 = sums.col2.A >= sums.col2.B ? 'S' : 'N';
            const L3 = sums.col3.A >= sums.col3.B ? 'T' : 'F';
            const L4 = sums.col4.A >= sums.col4.B ? 'J' : 'P';
            
            const finalType = L1 + L2 + L3 + L4;
            const info = typeDetails[finalType];

            // ************** å…³é”®ä¿®æ”¹ï¼šå­˜å‚¨åˆ° localStorage **************
            localStorage.setItem('dailySenseMBTI', finalType);
            // **********************************************************

            // 1. å¡«å……åŸºç¡€ä¿¡æ¯
            document.getElementById('resCode').innerText = finalType;
            document.getElementById('resName').innerText = info.name;
            document.getElementById('resSlogan').innerText = info.slogan;
            document.getElementById('artTitle').innerText = `${finalType}ï¼š${info.name}æ·±åº¦è§£ç `;

            // 2. æ¸²æŸ“ç»´åº¦èƒ½é‡æ¡
            renderBars(sums);

            // 3. ç»˜åˆ¶é›·è¾¾å›¾
            drawRadar({
                E: sums.col1.A, I: sums.col1.B,
                S: sums.col2.A, N: sums.col2.B,
                T: sums.col3.A, F: sums.col3.B,
                J: sums.col4.A, P: sums.col4.B
            });

            // 4. æ›´æ–°å¾®å‹å›¾è¡¨
            updateMiniCharts(sums);

            // 5. ç”Ÿæˆæ·±åº¦æ–‡æœ¬
            generateDeepText(L1, L2, L3, L4, info);
        }

        function renderBars(sums) {
            const setBar = (idL, idR, valL, valR) => {
                const total = valL + valR;
                const pctL = (valL / total) * 100;
                const pctR = (valR / total) * 100;
                document.getElementById(idL).style.width = pctL + "%";
                document.getElementById(idR).style.width = pctR + "%";
            };
            setBar('barE', 'barI', sums.col1.A, sums.col1.B);
            setBar('barS', 'barN', sums.col2.A, sums.col2.B);
            setBar('barT', 'barF', sums.col3.A, sums.col3.B);
            setBar('barJ', 'barP', sums.col4.A, sums.col4.B);
        }

        function updateMiniCharts(sums) {
            // ç”µæ± å›¾: Eå æ¯”é«˜åˆ™å®½ï¼ŒIå æ¯”é«˜åˆ™çª„
            const eTotal = sums.col1.A + sums.col1.B;
            const ePct = (sums.col1.A / eTotal) * 100;
            const bat = document.getElementById('batteryFill');
            bat.style.width = ePct + "%";
            bat.innerText = ePct > 50 ? "å¯¹å¤–è¾“å‡º" : "å‘å†…æ¢ç´¢";
            bat.style.background = ePct > 50 ? "#0071e3" : "#ff2d55"; // Eè“ Içº¢

            // å¤©å¹³å›¾: T vs F
            const tTotal = sums.col3.A + sums.col3.B;
            const tPct = (sums.col3.A / tTotal) * 100;
            // left: 0% is T, 100% is F. But wait, sums.col3.A is T.
            // So if T is 100%, knob should be left (0%).
            // Pos = 100 - tPct
            document.getElementById('balanceKnob').style.left = (100 - tPct) + "%";
        }

        function generateDeepText(l1, l2, l3, l4, info) {
            // 1. è®¤çŸ¥å†…æ ¸ (Core)
            let core = `<p class="text-para">ä½ å¥½ï¼Œ<strong>${info.name} (${l1}${l2}${l3}${l4})</strong>ã€‚åœ¨è¿™ä¸ªå–§åš£çš„ä¸–ç•Œé‡Œï¼Œä½ ç‹¬ç‰¹çš„æ€ç»´æ–¹å¼å°±åƒä¸€ç§ç¨€ç¼ºçš„ç®—æ³•ã€‚ä½ çš„èƒ½é‡ä¸»è¦æ¥æºäº${l1==='I'?'<strong>å†…å¿ƒä¸–ç•Œ</strong>ã€‚ä½ åƒä¸€ä½æ·±æµ·æ½œæ°´å‘˜ï¼Œå¤–éƒ¨çš„ç¤¾äº¤å¾€å¾€æ˜¯æ¶ˆè€—ï¼Œå”¯æœ‰ç‹¬å¤„æ—¶çš„æ·±åº¦æ€è€ƒèƒ½è®©ä½ æ»¡è¡€å¤æ´»':'<strong>å¤–éƒ¨ä¸–ç•Œ</strong>ã€‚ä½ å°±åƒå¤ªé˜³èƒ½ç”µæ± æ¿ï¼Œä¸äººäº’åŠ¨ã€å‚ä¸æ´»åŠ¨èƒ½è®©ä½ æ„Ÿåˆ°å…´å¥‹ï¼Œä½ æ˜¯åœ¨â€œåšâ€ä¸­â€œæƒ³â€çš„å¤©æ‰'}ã€‚</p>`;
            
            core += `<p class="text-para">åœ¨æ¥æ”¶ä¿¡æ¯æ—¶ï¼Œä½ æ›´å€¾å‘äº${l2==='S'?'ç›¸ä¿¡<strong>äº”å®˜çš„ç›´æ¥ç»éªŒ</strong>ã€‚ä½ æ´»åœ¨å½“ä¸‹ï¼ŒåŠ¡å®è€Œå…·ä½“ï¼Œæ¯”èµ·é£˜æ¸ºçš„æœªæ¥ï¼Œä½ æ›´åœ¨æ„æ‰‹é‡ŒæŠ“å¾—ä½çš„ç°åœ¨':'ä¾èµ–<strong>ç›´è§‰å’Œæƒ³è±¡</strong>ã€‚ä½ æ€»æ˜¯èƒ½ä¸€çœ¼çœ‹ç©¿äº‹ç‰©èƒŒåçš„æ¨¡å¼ï¼Œæ¯”èµ·æ¯ç‡¥çš„æ•°æ®ï¼Œæœªæ¥çš„å¯èƒ½æ€§æ›´è®©ä½ ç€è¿·'}ã€‚è€Œåœ¨åšå†³å®šæ—¶ï¼Œ${l3==='T'?'<strong>é€»è¾‘å’ŒçœŸç†</strong>æ˜¯ä½ å¿ƒä¸­çš„æœ€é«˜æ³•åˆ™ã€‚ä½ å®¢è§‚ã€å†·é™ï¼Œæœ‰æ—¶ç”šè‡³æ˜¾å¾—æœ‰ç‚¹â€œä¸è¿‘äººæƒ…â€ï¼Œä½†é‚£æ˜¯å› ä¸ºä½ è®¤ä¸ºåªæœ‰å…¬æ­£æ‰èƒ½å¸¦æ¥æœ€å¤§çš„å–„':'<strong>ä¸ªäººä»·å€¼è§‚å’Œä»–äººæ„Ÿå—</strong>æ˜¯ä½ çš„æŒ‡å—é’ˆã€‚ä½ å¯Œæœ‰åŒæƒ…å¿ƒï¼Œå–„è§£äººæ„ï¼Œæ„¿æ„ä¸ºäº†å’Œè°è€Œå¦¥åï¼Œæ˜¯å›¢é˜Ÿä¸­çš„æƒ…æ„Ÿç²˜åˆå‰‚'}ã€‚</p>`;
            
            core += `<p class="text-para">æœ€åï¼Œé¢å¯¹ç”Ÿæ´»ï¼Œä½ å–œæ¬¢${l4==='J'?'<strong>äº•ç„¶æœ‰åº</strong>ã€‚ä½ ä¹ æƒ¯æå‰è®¡åˆ’ï¼ŒæŒæ§è¿›åº¦ï¼Œçªå¦‚å…¶æ¥çš„å˜åŒ–ä¼šè®©ä½ æ„Ÿåˆ°ç„¦è™‘ï¼Œä½†ä¹Ÿæ­£æ˜¯è¿™ç§ç‰¹è´¨è®©ä½ æå…¶é è°±':'<strong>ä¿æŒå¼€æ”¾</strong>ã€‚ä½ çµæ´»ã€éšæ€§ï¼Œè®¤ä¸ºè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ï¼Œæœ€åæ—¶åˆ»çš„çˆ†å‘åŠ›å¾€å¾€èƒ½å¸¦æ¥æƒŠäººçš„åˆ›æ„'}ã€‚</p>`;
            document.getElementById('textCore').innerHTML = core;

            // 2. ä¼˜åŠ¿ä¸åŠ£åŠ¿
            let sw = `<p class="text-para"><strong>ä½ çš„å…‰èŠ’åœ¨äºï¼š</strong></p>`;
            sw += `<div class="list-item"><strong>${l2==='N'?'è¿œè§å“è¯†':'æå¼ºæ‰§è¡ŒåŠ›'}ï¼š</strong>${l2==='N'?'ä½ æ€»èƒ½æ¯”åˆ«äººå…ˆçœ‹åˆ°è¶‹åŠ¿ï¼Œå½“åˆ«äººè¿˜åœ¨è®¨è®ºç°åœ¨æ—¶ï¼Œä½ å·²ç»åœ¨å¸ƒå±€æœªæ¥ã€‚':'ä½ çš„æ‰‹æ€»æ˜¯æ¯”å˜´å¿«ï¼Œèƒ½å°†ç©ºä¸­æ¥¼é˜èˆ¬çš„æƒ³æ³•è¿…é€Ÿè½åœ°ä¸ºåˆ‡å®çš„æˆæœã€‚'}</div>`;
            sw += `<div class="list-item"><strong>${l3==='T'?'å†·é™çš„ç ´å±€è€…':'æ¸©æš–çš„ç–—æ„ˆè€…'}ï¼š</strong>${l3==='T'?'åœ¨å±æœºé¢å‰ï¼Œä½ ä¸ä¼šè¢«æƒ…ç»ªè£¹æŒŸï¼Œæ€»èƒ½è¿…é€Ÿæ‰¾åˆ°æœ€ä¼˜è§£ã€‚':'ä½ èƒ½æ•é”æ„ŸçŸ¥åˆ°åˆ«äººæœªè¯´å‡ºå£çš„æƒ…ç»ªï¼Œè®©äººæ„Ÿåˆ°è¢«ç†è§£å’Œæ¥çº³ã€‚'}</div>`;
            
            sw += `<p class="text-para" style="margin-top:20px;"><strong>è¿™æ˜¯ä½ çš„é˜´å½±åŒºï¼š</strong></p>`;
            sw += `<div class="list-item">${l1==='I'?'å®¹æ˜“è¿‡åº¦å°é—­ï¼Œæ´»åœ¨è‡ªå·±çš„é€»è¾‘é—­ç¯é‡Œï¼Œå¿½ç•¥äº†å¤–éƒ¨ä¸–ç•Œçš„çœŸå®åé¦ˆã€‚':'å®¹æ˜“å› è¿‡åº¦ç¤¾äº¤è€Œé€æ”¯ç²¾åŠ›ï¼Œå¿½ç•¥äº†æ·±åº¦åæ€çš„é‡è¦æ€§ã€‚'}</div>`;
            sw += `<div class="list-item">${l4==='J'?'æœ‰æ—¶æ˜¾å¾—è¿‡äºå›ºæ‰§ï¼Œå½“äº‹æƒ…è„±ç¦»æŒæ§æ—¶ä¼šäº§ç”Ÿä¸å¿…è¦çš„æ§åˆ¶æ¬²ã€‚':'å®¹æ˜“å› ä¸ºé€‰æ‹©å›°éš¾æˆ–æ‹–å»¶ï¼Œå¯¼è‡´æ‰åæ— æ³•åŠæ—¶è½¬åŒ–ä¸ºæˆæœã€‚'}</div>`;
            document.getElementById('textSW').innerHTML = sw;

            // 3. èŒåœº
            let work = `<p class="text-para">åœ¨å·¥ä½œä¸­ï¼Œä½ ä¸æ˜¯ä¸€é¢—èºä¸é’‰ï¼Œä½ æ˜¯${l2==='N'?'<strong>è®¾è®¡å¸ˆ</strong>':'<strong>å»ºé€ è€…</strong>'}ã€‚ä½ æœ€é€‚åˆçš„èŒä¸šç¯å¢ƒæ˜¯é‚£äº›èƒ½å¤Ÿå…è®¸ä½ ${l4==='P'?'è‡ªç”±å‘æŒ¥ã€çµæ´»åº”å¯¹æŒ‘æˆ˜':'å»ºç«‹ç§©åºã€é«˜æ•ˆè¾¾æˆç›®æ ‡'}çš„åœ°æ–¹ã€‚</p>`;
            work += `<p class="text-para"><strong>æ¨èèŒä¸šæ–¹å‘ï¼š</strong>${info.careers}ã€‚è¿™äº›é¢†åŸŸèƒ½è®©ä½ æœ€å¤§åŒ–å‘æŒ¥${l3==='T'?'é€»è¾‘åˆ†æ':'äººé™…å…±æƒ…'}çš„ä¼˜åŠ¿ã€‚</p>`;
            work += `<p class="text-para">ç»™ä½ çš„èŒåœºå»ºè®®ï¼šå½“å›¢é˜Ÿå‘ç”Ÿå†²çªæ—¶ï¼Œè®°å¾—${l3==='T'?'å¶å°”åœä¸‹æ¥å¬å¬å¤§å®¶çš„æƒ…ç»ªï¼Œé€»è¾‘æ˜¯å¯¹çš„ï¼Œä½†äººä¸æ€»æ˜¯ç†æ€§çš„':'å­¦ä¼šé€‚åº¦æŠ½ç¦»ï¼Œä¸è¦æŠŠå·¥ä½œä¸­çš„å®¢è§‚è¯„ä»·å½“ä½œå¯¹ä½ ä¸ªäººçš„æ”»å‡»'}ã€‚</p>`;
            document.getElementById('textWork').innerHTML = work;

            // 4. æƒ…æ„Ÿ
            let love = `<p class="text-para">åœ¨äº²å¯†å…³ç³»ä¸­ï¼Œä½ ${l1==='I'?'è™½ç„¶ä¸å–„è¨€è¾ï¼Œä½†çˆ±å¾—æ·±æ²‰ã€‚ä½ éœ€è¦çš„ä¸æ˜¯æ•´å¤©è…»åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯æ·±å±‚æ¬¡çš„ç²¾ç¥å…±é¸£':'çƒ­æƒ…æ´‹æº¢ï¼Œä¹äºåˆ†äº«ç”Ÿæ´»ç‚¹æ»´ã€‚ä½ å¸Œæœ›ä¼´ä¾£èƒ½å’Œä½ ä¸€èµ·æ¢ç´¢ä¸–ç•Œï¼Œå›åº”ä½ çš„æ¿€æƒ…'}ã€‚</p>`;
            love += `<p class="text-para">ä½ çš„ç†æƒ³ä¼´ä¾£æ˜¯é‚£ä¸ªèƒ½${l2==='S'?'é™ªä½ æŠŠæŸ´ç±³æ²¹ç›è¿‡å‡ºæ»‹å‘³':'æ‡‚ä½ é‚£äº›å¤©é©¬è¡Œç©ºæƒ³æ³•'}çš„äººã€‚æ³¨æ„ï¼Œå½“çŸ›ç›¾å‘ç”Ÿæ—¶ï¼Œä½ ä¹ æƒ¯${l3==='T'?'è®²é“ç†':'è®²æ„Ÿå—'}ï¼Œä½†è¿™å¾€å¾€æ˜¯äº‰åµçš„æ ¹æºã€‚è¯•ç€æ¢ä½æ€è€ƒï¼š${l3==='T'?'â€œå¯¹é”™ä¸é‡è¦ï¼Œta ç°åœ¨çš„æ„Ÿå—æ‰é‡è¦â€':'â€œä»–ä¸æ˜¯ä¸çˆ±æˆ‘ï¼Œä»–åªæ˜¯åœ¨å°è¯•è§£å†³é—®é¢˜â€'}ã€‚</p>`;
            document.getElementById('textLove').innerHTML = love;

            // 5. å»ºè®®
            let advice = `<div class="list-item"><strong>æ¥çº³è‡ªå·±ï¼š</strong>ä¸è¦å¼ºè¿«è‡ªå·±å˜æˆåˆ«äººçœ¼ä¸­çš„â€œå®Œç¾æ€§æ ¼â€ã€‚${l1==='I'?'å†…å‘ä¸æ˜¯ç¼ºé™·ï¼Œæ˜¯ä½ çš„åŠ›é‡ä¹‹æºã€‚':'å¤–å‘ä¸ä»£è¡¨è‚¤æµ…ï¼Œæ˜¯ä½ çš„è¿æ¥èƒ½åŠ›ã€‚'}</div>`;
            advice += `<div class="list-item"><strong>åˆ»æ„ç»ƒä¹ ï¼š</strong>${l2==='N'?'è¯•ç€å»å…³æ³¨ä¸€æ¬¡è·¯è¾¹çš„èŠ±è‰ï¼Œè½åœ°ä¸€ç‚¹ï¼Œç”Ÿæ´»ä¼šæ›´çœŸå®ã€‚':'è¯•ç€å»è¯»ä¸€æœ¬å“²å­¦ä¹¦ï¼ŒæŠ½è±¡ä¸€ç‚¹ï¼Œä¸–ç•Œä¼šæ›´å¹¿é˜”ã€‚'}</div>`;
            advice += `<div class="list-item"><strong>å…³äºæœªæ¥ï¼š</strong>MBTI åªæ˜¯ä½ å‡ºå‚æ—¶çš„è®¾ç½®ï¼Œä¸æ˜¯ä½ äººç”Ÿçš„ç»ˆå±€ã€‚ä½ éšæ—¶å¯ä»¥è‡ªæˆ‘è¿›åŒ–ï¼Œå»æˆä¸ºé‚£ä¸ªæ›´åŠ å®Œæ•´çš„è‡ªå·±ã€‚</div>`;
            document.getElementById('textAdvice').innerHTML = advice;
        }

        // ==================== 5. Canvas é›·è¾¾å›¾ ====================
        function drawRadar(scores) {
            const canvas = document.getElementById('radarCanvas');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const w = 260, h = 260;
            canvas.width = w * dpr; canvas.height = h * dpr;
            canvas.style.width = w + "px"; canvas.style.height = h + "px";
            ctx.scale(dpr, dpr);

            const cx = w/2, cy = h/2;
            const radius = 80;
            const labels = ["E", "S", "T", "J", "I", "N", "F", "P"];
            const values = [
                scores.E, scores.S, scores.T, scores.J,
                scores.I, scores.N, scores.F, scores.P
            ];
            const maxVal = 60;

            // ç½‘æ ¼
            ctx.strokeStyle = "#e5e5ea";
            ctx.lineWidth = 1;
            for (let r = 1; r <= 4; r++) {
                ctx.beginPath();
                for (let i = 0; i < 8; i++) {
                    const angle = (Math.PI * 2 * i) / 8 - Math.PI / 2;
                    const dist = (radius / 4) * r;
                    const x = cx + Math.cos(angle) * dist;
                    const y = cy + Math.sin(angle) * dist;
                    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                }
                ctx.closePath();
                ctx.stroke();
            }

            // è½´çº¿ä¸æ–‡å­—
            ctx.fillStyle = "#888";
            ctx.font = "bold 11px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            for (let i = 0; i < 8; i++) {
                const angle = (Math.PI * 2 * i) / 8 - Math.PI / 2;
                const x = cx + Math.cos(angle) * radius;
                const y = cy + Math.sin(angle) * radius;
                
                ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(x, y); ctx.stroke();
                
                const tx = cx + Math.cos(angle) * (radius + 15);
                const ty = cy + Math.sin(angle) * (radius + 15);
                ctx.fillText(labels[i], tx, ty);
            }

            // æ•°æ®å±‚
            ctx.beginPath();
            for (let i = 0; i < 8; i++) {
                const angle = (Math.PI * 2 * i) / 8 - Math.PI / 2;
                const val = values[i];
                const dist = (val / maxVal) * radius;
                const x = cx + Math.cos(angle) * dist;
                const y = cy + Math.sin(angle) * dist;
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.closePath();
            ctx.fillStyle = "rgba(0,0,0,0.05)";
            ctx.fill();
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 2;
            ctx.stroke();

            // ç‚¹
            for (let i = 0; i < 8; i++) {
                const angle = (Math.PI * 2 * i) / 8 - Math.PI / 2;
                const val = values[i];
                const dist = (val / maxVal) * radius;
                const x = cx + Math.cos(angle) * dist;
                const y = cy + Math.sin(angle) * dist;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI*2);
                ctx.fillStyle = "#fff"; ctx.fill();
                ctx.strokeStyle = "#000"; ctx.stroke();
            }
        }
    </script>
</body>
</html>

